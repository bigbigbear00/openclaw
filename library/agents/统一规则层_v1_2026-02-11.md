# 统一规则层 v1（全员）

生效时间：2026-02-11
适用范围：所有 Agent 的 cron/定时任务与主控回执
目标：限制自由发挥边界，统一参数与输出协议，降低错误与噪音。

---

## 1) 参数统一（硬约束）

### 1.1 web_search 参数白名单
- `search_lang` 仅允许：`en | zh-hans | zh-hant | vi`
- `ui_lang` 仅允许：`en-US | zh-CN | zh-TW`（不确定可省略）
- `country` 仅允许 Brave 合法枚举（如 `US/CN/GB/ALL`）

### 1.2 非法参数自动降级
- 若参数不合法：先修正到白名单；
- 仍不确定：`country=ALL`、`ui_lang` 省略、`search_lang` 按语境回退为 `en`。
- 明确禁止：
  - `ui_lang=en/zh/vi/zh-hans`
  - `search_lang=zh/en-US/zh-CN`
  - `country=VN/MO`（及任何非枚举值）

---

## 2) 输出统一（硬约束）

### 2.1 NO_CHANGE => NO_REPLY
无新增事实、无新增影响、无新增动作建议时，必须输出 `NO_REPLY`。

### 2.2 STRICT_OUTPUT
- 禁止输出过程日志、角色口播、脚本全文、调试过程。
- 当任务要求“仅结果体/正文/stdout”时，严格仅输出目标结果。

### 2.3 篇幅上限
- cron 对外播报默认不超过 6-8 行。
- 默认格式：`新增事实 + 影响 + 下一步`。

---

## 3) 协作统一（状态卡）

所有 Agent 回主控必须包含：

```text
[STATE_CARD]
status: PLANNED|RUNNING|BLOCKED|FAILED|DONE
eta: <ISO时间或相对时间>
artifact: <绝对路径或none>
blocker: <无则none>
```

---

## 4) 回归与防漂移

每日巡检三项指标：
1. `Unable to validate request parameter(s)` 计数
2. `NO_REPLY` 命中率（无变化场景）
3. 超长/跑题输出比率

若任一指标劣化：
- 标记任务为 drift；
- 回滚到上个稳定模板；
- 由主控二次下发修正。

---

## 5) 执行边界（保持）

- Agent 可自由发挥：分析、判断、内容组织。
- Agent 不可自由发挥：接口参数、输出协议、对外播报结构。

> 原则：创作自由保留在“内容层”，稳定性控制收口在“协议层”。
