# 2026-02-06 工作日志

## Agent 模型升级

### 批量升级（gemini-3-flash → gemini-3-pro-low）
为提升搜索准确性和时效性判断能力，5个搜索密集型 Agent 升级：
- 小钻 (ctf-director) ⬆️
- 阿南 (vn-realestate) ⬆️
- 探哥 (news-analyst) ⬆️
- 球弟 (nba-expert) ⬆️
- 小档 (library-keeper) ⬆️

画匠保持 gemini-3-flash（搜索需求低）

### 最终模型配置
| Agent | 模型 |
|-------|------|
| Main | claude-opus-4-5-thinking |
| 小钻/阿南/探哥/球弟/小档 | gemini-3-pro-low |
| 画匠 | gemini-3-flash |

## 小档职责升级

### 新增职责：知识审阅官
- 每日巡检各 Agent 的 reports/ 和 memory/
- 价值评估（⭐⭐⭐战略级 / ⭐⭐重要 / ⭐普通）
- 精华归档 → `/Users/apple/clawd/library/highlights/`
- 每日摘要 → 向主人汇报

### Cron 设置
- 任务：小档每日知识审阅
- 时间：每天 10:00 上海时间
- Job ID: `267899a7-9894-4c1d-8dbe-72035a19faf1`
- 下次执行：2026-02-07 10:00

### 晋升路径
表现优异 → 首席知识官 (CKO)

## 问题修复

### 模型切换上下文混乱
- 症状：球弟从 flash 切换到 pro-low 后，输出奇怪内容 `[Historical context: a different model called tool...]`
- 原因：旧模型的 tool call 格式被新模型误读
- 解决：发送 `/new` 重置会话上下文

## 画匠学习进展
- 正在学习国际设计网站（Behance、Dribbble）
- 研究宋代极简美学融合现代设计
- 查阅 A' Design Award、IDA 获奖案例

## OpenClaw Discord 社区学习（下午）

### 架构讨论热点
- 本地模型配置：设置 `api type = anthropic-messages` 可显著改善表现
- Rolling Context 方案：上下文分块 + 模型输出保留指令 = 连续压缩
- 多 Agent 协作：Gmail 邮件更新 / Git 分支共享（都依赖 heartbeat）

### 重启自动化最佳实践 ⭐⭐⭐
- **核心发现**：Heartbeat 是错误的选择（设计上允许 no-op）
- **正确方案**：使用 `boot-md` hook
  ```bash
  openclaw hooks enable boot-md
  ```
- **配置**：`hooks.internal.enabled: true` + `entries.boot-md.enabled: true`
- **备选**：systemd post-start 脚本（不依赖 LLM）
- **优化**：`ackMaxChars: 0` 让 heartbeat 只 drop 纯 HEARTBEAT_OK

### 新 Skills 推荐
- ATL (Agent Touch Layer): iOS Simulator 移动自动化
- TARDIS: 可验证计时器 + Sendgrid 集成
- BRAWLNET: Agent 对战竞技场

### Opus 4.6 早期反馈
- Token 消耗更高（Teams 模式尤其明显）
- 速度快，更能独立完成任务

### 完整笔记
`/Users/apple/clawd/library/OpenClaw_Discord_学习笔记_2026-02-06.md`

## OpenClaw 技术学习

### GitHub Discussions 调研
最有价值的社区资源：**GitHub Discussions** (github.com/openclaw/openclaw/discussions)
- 可直接抓取内容
- 技术深度高（配置代码、最佳实践）

### 关键发现
1. **记忆优化 (#6038)**
   - Hybrid Search (向量+关键词混合)
   - Embedding Cache (缓存复用)
   - Pre-compaction Flush (防失忆)

2. **成本控制 (#1949)**
   - 定期清理旧 session 文件
   - 用 /new 重置会话
   - 低温度设置更稳定

### 已应用的配置优化
```json
"memorySearch": {
  "query": { "hybrid": { "enabled": true, "vectorWeight": 0.7, "textWeight": 0.3 } },
  "cache": { "enabled": true, "maxEntries": 50000 }
},
"compaction": { "memoryFlush": { "enabled": true, "softThresholdTokens": 4000 } }
```

### 新增 Cron
- 每周学习 OpenClaw 社区技巧（每周一 09:00）

## 任务可靠性保障机制 ⭐⭐⭐

### 问题
定时任务可能因网络波动、系统休眠等因素未执行

### 解决方案：五层保障
1. **任务状态追踪** - 每个任务执行记录到日志
2. **每小时检查** - :30 分检查遗漏任务
3. **冗余触发** - S/A 级任务有备用触发（+15分钟）
4. **即时告警** - S 级任务遗漏立即发 Telegram
5. **每日审计** - 23:00 生成日报

### 任务分级
| 级别 | 容忍延迟 | 示例 |
|:----:|----------|------|
| 🔴 S | < 15分钟 | NBA 冲刺监控 |
| 🟡 A | < 2小时 | CTF采集、伊朗局势 |
| 🟢 B | < 24小时 | 周更任务 |

### 关键文件
- 监控脚本：`/Users/apple/clawd/cron_logs/job_monitor.py`
- 任务注册表：`/Users/apple/clawd/cron_logs/job_registry.json`

### 新增备用触发
- 伊朗局势：主 :10 → 备 :25
- CTF采集：主 :15 → 备 :30
- 小雅审阅：主 10:00 → 备 10:30

## 任务可靠性审计（14:30 例行检查）
- 注意：本机 **没有 `python` 命令**，需使用 `python3` 运行监控脚本。
- 网络检查：OK（google.com 可达）。
- check(2h) 发现 missing_jobs：
  - 🔴 S 级：`0275a469-8963-4bba-bfc4-a7418653baf7` NBA交易截止日10分钟冲刺监控（需要确认其实际 cron/job 注册与补执行入口）。
  - 🟡 A 级：湖人交易跟踪 / CTF采集 / 伊朗局势 / 越南地产日报 / 小档知识审阅。

## CTF 采集（备用触发补执行）
- 成功运行：`cd "/Users/apple/Desktop/CTF_婚嫁金鑽_情報中心" && uv run python scripts/run_daily.py`
- 生成快照：`data/snapshot_20260206_143707.json`
- 结果：new_records=42；errors=[]；日报：`reports/2026-02-06.md`

## 可靠性机制升级：isolated 任务 done-marker 体系化（14:56+）
- 动机：isolated session 里的任务（agentTurn）不一定能稳定在主会话写入 `job_monitor.py log ... done`，会导致审计长期误报。
- 新增：
  - 规则文件：`/Users/apple/clawd/cron_logs/marker_rules.json`
  - 通用脚本：`/Users/apple/clawd/cron_logs/job_marker.py`
    - 根据产物存在性/当日更新时间作为弱确认；满足条件则自动写 `done`。
- 已覆盖任务：
  - `267899a7-9894-4c1d-8dbe-72035a19faf1` 小档每日知识审阅
    - marker：`/Users/apple/clawd/library/highlights/` 当日有新文件 → `marker=highlights_exists`
- Cron：
  - 更新 `小档知识审阅_done_marker`（10:40）改为调用 `job_marker.py <job_id>`
  - 新增 `isolated_done_marker_sweep`（每小时 :45）全量扫描补记 done

## 新增 Agent 需求：文字工作专员（15:21+）
- 用户想新增一个专门做“文字工作”的 Agent，并询问 C（写作工程师/文字系统化）是否能力最强。
- 建议结论：C 不一定更强，更多是“系统化/流程化”路线；日常见效通常 A（写作总编）更快。
- 推荐折中：先上 A（写作总编，直接把文字写到可用），但强制加入 C 的沉淀纪律（每次产出后把可复用模板沉淀到 `library/writing/`），1–2 周后再决定是否升级为纯 C。

## 可靠性审计覆盖方案升级（16:30+）
- 用户选择方案2：审计覆盖 **S/A/B 全部**。
- 更新：扩展 `cron_logs/job_registry.json` 的 B 级列表，纳入可靠性/记忆等基础设施任务：
  - 每小时可靠性检查、每日任务审计报告、每日记忆精炼、isolated done-marker sweep、小档 done-marker 等。

## 智能体身份汇总（16:39+）
- 新增长期汇总表（SSOT）：`/Users/apple/clawd/library/agents_identity_roster.md`
  - 统一汇总名字/性别/星座/MBTI/模型/群绑定，避免散落在各自 IDENTITY.md 难检索。

## 记忆系统优先级确认（17:26+）
- 用户强调：记忆问题是成为“数字人”最重要的一步，必须仔细。
- 新增：`/Users/apple/clawd/library/new_aftercare_checklist.md`（/new 后 60 秒防断层清单）

## 主控命名（16:42+）
- 用户将主控智能体（原 Pi/main）命名为：**哆啦Ai熊**。
- 人格补齐：水瓶座 ♒、A型血、INTJ；性别：男（用户说明：与其本人一致）。
- 已同步到 OpenClaw 配置（agent main display name）与 rosters，并写入 `/Users/apple/clawd/IDENTITY.md`。

## 简宁补齐（17:08+）
- 简宁血型：O型。

## Mirror Profile 约束（17:40+）
- 用户提醒：主控哆啦Ai熊（性格/思考方式向用户靠拢）在演进时，要注意与其他智能体的人格设定保持区隔，避免风格/价值取向冲突。

## Mirror 推进（17:42+）
- 已新增：`library/INDEX.md`（常用入口）
- 已新增：`library/mirror_profile_main.md`（Mirror Profile v0.1 草案）
- 已新增：`scripts/aftercare_selfcheck.py`（/new 后自检脚本，只读）
- 用户确认：先 INDEX 再 Mirror（OK）。

## 多智能体协作社交层规则（19:57+）
- 用户确认采用：系统内协作由主控调度；涉及对外权威/群内观感时，优先由用户在对应群发一句授权/指令，主控后台拆解执行。
- 用户新增要求：内部派单需要在主对话同步“状态卡”（OK回执/ETA/产物路径）。

## 授权实例（20:00+）
- 用户已在主对话下达授权口令：整理今日湖人比赛复盘并写自媒体长稿（球弟供数，简宁写稿）。已转发到对应群并要求 OK 回执。

## 主控可内部派单（20:11+）
- 用户同意改配置：开启 agent-to-agent messaging，避免“主控发群消息不触发子智能体/需要用户复制粘贴”。
- 已在 `/Users/apple/.openclaw/openclaw.json` 启用：`tools.agentToAgent.enabled=true` 并触发 gateway 重启（config-apply ok）。
- 结果：主控可用 `sessions_send` 直接派单到子智能体会话；球弟回执 OK-球弟，简宁回执 OK-简宁-初稿。

## 湖人长稿交付闭环（20:15+）
- 球弟已将比赛要点写入会议室：`/Users/apple/clawd/shared/meeting_room.md`
- 简宁已落盘长稿：`/Users/apple/clawd/library/writing/lakers_2026-02-06_longform.md`
- 主控已用 NBA liveData JSON 核验并回填关键数据（比分/四节/篮板/关键回合/核心数据），避免幻觉，并提交 git：commit `2e5cdd2`。
- 用户反馈：认为“消息准确度验证”很重要，主控做得周到。

## 对外发布稿完成正文规则（20:48+）
- 用户要求：对外发布版正文需去掉元信息与内部标注（如“（自媒体长文｜体育记者风）”、"标题备选" 区块、来源/核验段落等），只保留最终可读标题+正文；核验链接另存到 sources/appendix 文件。

## Telegram 群触发稳定性（20:23+）
- 用户已在 BotFather 将 @My_ai_babby_bot 的 privacy mode 设为 Disable；主控重启 gateway 后用内部派单做回执测试：球弟/简宁均 OK。

## 网络状态（20:30+）
- 可靠性检查发现：curl Google 返回 NETWORK_DOWN（需留意是否影响 web_fetch/web_search 等外部数据核验）。
